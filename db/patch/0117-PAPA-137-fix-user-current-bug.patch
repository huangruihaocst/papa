From be8767bab53ff0e6e95511fa50abf6ef23c09024 Mon Sep 17 00:00:00 2001
From: Alex Wang <ice_b0und@hotmail.com>
Date: Fri, 23 Oct 2015 15:44:11 +0800
Subject: [PATCH 117/150] PAPA-137 fix user current bug

---
 .python-version                     | 2 +-
 app/controllers/users_controller.rb | 5 +++--
 config/routes.rb                    | 2 +-
 3 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/.python-version b/.python-version
index 6cb9d3d..6a81b4c 100644
--- a/.python-version
+++ b/.python-version
@@ -1 +1 @@
-3.4.3
+2.7.8
diff --git a/app/controllers/users_controller.rb b/app/controllers/users_controller.rb
index 4b715d3..ac6a9ae 100644
--- a/app/controllers/users_controller.rb
+++ b/app/controllers/users_controller.rb
@@ -1,7 +1,8 @@
 class UsersController < ApplicationController
   def current
-    if current_user
-      render json: { status: STATUS_SUCCESS, id: current_user.id.to_s }
+    user = check_login
+    if user
+      render json: { status: STATUS_SUCCESS, id: user.id.to_s }
     else
       json_failed(REASON_PERMISSION_DENIED)
     end
diff --git a/config/routes.rb b/config/routes.rb
index 4ffa8cf..cec5710 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -8,7 +8,7 @@ Rails.application.routes.draw do
     registrations: 'users/registrations'
   }
 
-  get 'users/current_user.json' => 'users#current'
+  get 'users/current' => 'users#current'
 
   resources :semesters, only: [:index, :create, :update, :destroy] do
     resources :courses, only: [:index]
-- 
1.9.1

