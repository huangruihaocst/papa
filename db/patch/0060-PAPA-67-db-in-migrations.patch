From 5e52b25a65016198d4ed0b5911d67ade6618da8f Mon Sep 17 00:00:00 2001
From: Alex Wang <ice_b0und@hotmail.com>
Date: Sun, 11 Oct 2015 01:04:01 +0800
Subject: [PATCH 060/150] PAPA-67 db in migrations

---
 README.md                                          | 25 +++++--
 db/migrate/20150926114146_devise_create_users.rb   |  7 +-
 ...50930115150_add_lessons_studends_and_courses.rb | 69 ++++++++++++++++-
 db/schema.rb                                       | 86 ++++++++++++++++++++--
 4 files changed, 168 insertions(+), 19 deletions(-)

diff --git a/README.md b/README.md
index ddbac4c..02a6289 100644
--- a/README.md
+++ b/README.md
@@ -231,12 +231,12 @@ REASON_TOKEN_NOT_MATCH = 'token_not_match'  // id和token不匹配或者id不存
 
 1. Database Schema
 
-    semester number=int,
+    semester id=int 
+            name=string,
             has_many courses
     
     course  id=int,
             name=string,
-            semester=int,
             description=string
             ,
             belongs_to semester,
@@ -287,16 +287,19 @@ REASON_TOKEN_NOT_MATCH = 'token_not_match'  // id和token不匹配或者id不存
     assisting_course id=int
             belongs_to user
             belongs_to course
-    leaning_course id=int
+    learning_course id=int
             belongs_to user
             belongs_to course
     lesson_status id=int
+            score=string
             belongs_to user
             belongs_to lesson
+            timestamps
 
     lesson_remark id=int,        // 学生对实验课的评价
             content=string,
             score=int
+            timestamps
             ,
             belongs_to creator, as: :user,
             belongs_to lesson
@@ -304,29 +307,35 @@ REASON_TOKEN_NOT_MATCH = 'token_not_match'  // id和token不匹配或者id不存
     student_remark id=int,       // 助教对学生的评价
             content=string,
             score=int(0-10)
+            timestamps
             ,
             belongs_to lesson
             belongs_to creator, as: :user,
             belongs_to student, as: :user,
-            belongs_to lesson
             
     message id=int,
             type=string(homework|notification),
             title=string,
             deadline=datetime,
             content=string
+            timestamps
             ,
             belongs_to creator, as: :user
             belongs_to course
+           
             
     file    id=int,
             type=string,
             name=string,
-            path=string
+            path=string,
+            timestamps
             ,
             belongs_to creator, as: :user
+            
     
-    android id=int
-            version=string
+    android_app id=int,
+            version=string,
+            timestamps
             ,
-            belongs_to file
\ No newline at end of file
+            belongs_to file
+            
\ No newline at end of file
diff --git a/db/migrate/20150926114146_devise_create_users.rb b/db/migrate/20150926114146_devise_create_users.rb
index 40cb06f..0261d35 100644
--- a/db/migrate/20150926114146_devise_create_users.rb
+++ b/db/migrate/20150926114146_devise_create_users.rb
@@ -21,12 +21,17 @@ class DeviseCreateUsers < ActiveRecord::Migration
       t.string   :current_sign_in_ip
       t.string   :last_sign_in_ip
 
+      ## Additional
       t.boolean  :is_teacher, default: true
+      t.integer  :avator_id
+      t.string   :class_name
+      t.string   :department
+      t.integer  :student_number
 
       t.timestamps null: false
     end
 
-    #add_index :users, :phone,                unique: true
+    add_index :users, :phone,                unique: true
     add_index :users, :email,                unique: true
     add_index :users, :reset_password_token, unique: true
     # add_index :users, :confirmation_token,   unique: true
diff --git a/db/migrate/20150930115150_add_lessons_studends_and_courses.rb b/db/migrate/20150930115150_add_lessons_studends_and_courses.rb
index e2bd5cf..554ffcc 100644
--- a/db/migrate/20150930115150_add_lessons_studends_and_courses.rb
+++ b/db/migrate/20150930115150_add_lessons_studends_and_courses.rb
@@ -2,8 +2,10 @@ class AddLessonsStudendsAndCourses < ActiveRecord::Migration
   def change
 
     create_table :courses do |t|
-      t.string  :name
+      t.string  :name,        null: false
       t.text    :description
+
+      t.integer :semester_id
     end
 
     create_table :lessons do |t|
@@ -12,7 +14,7 @@ class AddLessonsStudendsAndCourses < ActiveRecord::Migration
       t.datetime  :start_time
       t.datetime  :end_time
       t.string  :location
-      t.integer :course_id
+      t.integer :course_id,   null: false
     end
 
     create_table :participations do |t|
@@ -21,5 +23,68 @@ class AddLessonsStudendsAndCourses < ActiveRecord::Migration
       t.string  :role, default: ROLE_STUDENT # student/assitant
     end
 
+    create_table :teaching_courses do |t|
+      t.integer :user_id
+      t.integer :course_id
+    end
+
+    create_table :assisting_courses do |t|
+      t.integer :user_id
+      t.integer :course_id
+    end
+
+    create_table :learning_courses do |t|
+      t.integer :user_id
+      t.integer :course_id
+    end
+
+    create_table :lesson_statuses do |t|
+      t.string :score
+      t.integer :user_id
+      t.integer :lesson_id
+      t.timestamps
+    end
+
+    create_table :lesson_remarks do |t|
+      t.text :content
+      t.integer :score
+      t.integer :creator_id
+      t.integer :lesson_id
+      t.timestamps
+    end
+
+    create_table :student_remarks do |t|
+      t.text :content
+      t.integer :score
+      t.integer :creator_id
+      t.integer :lesson_id
+      t.integer :student_id
+      t.timestamps
+    end
+
+    create_table :messages do |t|
+      t.string :type
+      t.string :title
+      t.datetime :deadline
+      t.text :content
+      t.integer :creator_id
+      t.integer :course_id
+      t.timestamps
+    end
+
+    create_table :files do |t|
+      t.string :type
+      t.string :name
+      t.string :path
+      t.integer :creator_id
+      t.timestamps
+    end
+
+    create_table :android_apps do |t|
+      t.string :version
+      t.integer :file_id
+      t.timestamps
+    end
+
   end
 end
diff --git a/db/schema.rb b/db/schema.rb
index 7f05bfb..904dc69 100644
--- a/db/schema.rb
+++ b/db/schema.rb
@@ -11,11 +11,55 @@
 #
 # It's strongly recommended that you check this file into your version control system.
 
-ActiveRecord::Schema.define(version: 20151009065201) do
+ActiveRecord::Schema.define(version: 20151008120334) do
+
+  create_table "android_apps", force: :cascade do |t|
+    t.string   "version"
+    t.integer  "file_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
+  end
+
+  create_table "assisting_courses", force: :cascade do |t|
+    t.integer "user_id"
+    t.integer "course_id"
+  end
 
   create_table "courses", force: :cascade do |t|
-    t.string "name"
-    t.text   "description"
+    t.string  "name",        null: false
+    t.text    "description"
+    t.integer "semester_id"
+  end
+
+  create_table "files", force: :cascade do |t|
+    t.string   "type"
+    t.string   "name"
+    t.string   "path"
+    t.integer  "creator_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
+  end
+
+  create_table "learning_courses", force: :cascade do |t|
+    t.integer "user_id"
+    t.integer "course_id"
+  end
+
+  create_table "lesson_remarks", force: :cascade do |t|
+    t.text     "content"
+    t.integer  "score"
+    t.integer  "creator_id"
+    t.integer  "lesson_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
+  end
+
+  create_table "lesson_statuses", force: :cascade do |t|
+    t.string   "score"
+    t.integer  "user_id"
+    t.integer  "lesson_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
   end
 
   create_table "lessons", force: :cascade do |t|
@@ -24,7 +68,18 @@ ActiveRecord::Schema.define(version: 20151009065201) do
     t.datetime "start_time"
     t.datetime "end_time"
     t.string   "location"
+    t.integer  "course_id",   null: false
+  end
+
+  create_table "messages", force: :cascade do |t|
+    t.string   "type"
+    t.string   "title"
+    t.datetime "deadline"
+    t.text     "content"
+    t.integer  "creator_id"
     t.integer  "course_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
   end
 
   create_table "participations", force: :cascade do |t|
@@ -33,17 +88,27 @@ ActiveRecord::Schema.define(version: 20151009065201) do
     t.string  "role",      default: "student"
   end
 
+  create_table "student_remarks", force: :cascade do |t|
+    t.text     "content"
+    t.integer  "score"
+    t.integer  "creator_id"
+    t.integer  "lesson_id"
+    t.integer  "student_id"
+    t.datetime "created_at"
+    t.datetime "updated_at"
+  end
+
+  create_table "teaching_courses", force: :cascade do |t|
+    t.integer "user_id"
+    t.integer "course_id"
+  end
+
   create_table "tokens", force: :cascade do |t|
     t.string   "token",       null: false
     t.integer  "user_id",     null: false
     t.datetime "valid_until", null: false
   end
 
-  create_table "upload_files", force: :cascade do |t|
-    t.string  "path"
-    t.integer "user_id"
-  end
-
   create_table "users", force: :cascade do |t|
     t.string   "name",                   default: ""
     t.string   "phone"
@@ -58,11 +123,16 @@ ActiveRecord::Schema.define(version: 20151009065201) do
     t.string   "current_sign_in_ip"
     t.string   "last_sign_in_ip"
     t.boolean  "is_teacher",             default: true
+    t.integer  "avator_id"
+    t.string   "class_name"
+    t.string   "department"
+    t.integer  "student_number"
     t.datetime "created_at",                            null: false
     t.datetime "updated_at",                            null: false
   end
 
   add_index "users", ["email"], name: "index_users_on_email", unique: true
+  add_index "users", ["phone"], name: "index_users_on_phone", unique: true
   add_index "users", ["reset_password_token"], name: "index_users_on_reset_password_token", unique: true
 
 end
-- 
1.9.1

