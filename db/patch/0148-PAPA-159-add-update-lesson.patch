From 118ae9b5a666005612bb250e4a83aa922ea08b6c Mon Sep 17 00:00:00 2001
From: Alex Wang <ice_b0und@hotmail.com>
Date: Sat, 24 Oct 2015 18:37:27 +0800
Subject: [PATCH 148/150] PAPA-159 add update lesson

---
 app/controllers/lessons_controller.rb | 17 +++++++++++++++++
 config/routes.rb                      |  2 +-
 2 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/app/controllers/lessons_controller.rb b/app/controllers/lessons_controller.rb
index 5b2dd31..7f671d8 100644
--- a/app/controllers/lessons_controller.rb
+++ b/app/controllers/lessons_controller.rb
@@ -46,6 +46,23 @@ class LessonsController < ApplicationController
     end
   end
 
+  # PUT /lessons/1.json
+  def update
+    begin
+      @lesson = Lesson.find(params[:id])
+    rescue ActiveRecord::RecordNotFound
+      json_failed(REASON_RESOURCE_NOT_FOUND)
+      return
+    end
+
+    must_be_a_teacher_of(params[:token], @lesson.course)
+    if @lesson.update(params.require(:lesson).permit(:name, :description))
+      json_successful
+    else
+      json_failed
+    end
+  end
+
   # DELETE /lessons/1.json
   def destroy
     if @lesson
diff --git a/config/routes.rb b/config/routes.rb
index d89a590..1574f95 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -32,7 +32,7 @@ Rails.application.routes.draw do
     get 'comments' => 'lesson_comments#index', as: :comments_of_course
   end
 
-  resources :lessons, only: [:show, :destroy] do
+  resources :lessons, only: [:show, :destroy, :update] do
     # students' comments to the lesson
     resources :comments, controller: 'lesson_comments', only: [:index, :create]
 
-- 
1.9.1

