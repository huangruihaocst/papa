From 82e4712e3b7095ef373ef263190482d8cf1bc67a Mon Sep 17 00:00:00 2001
From: luogan <luogan_62625686@126.com>
Date: Fri, 23 Oct 2015 14:03:51 +0800
Subject: [PATCH 116/150] PAPA-118

---
 app/views/manage/main_page.html.erb | 41 +++++++++++++++++++------------------
 1 file changed, 21 insertions(+), 20 deletions(-)

diff --git a/app/views/manage/main_page.html.erb b/app/views/manage/main_page.html.erb
index 08a7169..4280714 100644
--- a/app/views/manage/main_page.html.erb
+++ b/app/views/manage/main_page.html.erb
@@ -59,7 +59,7 @@
 				</div>
 				<div class="modal-body">
 					<h4>学期名称</h4>
-					<input id="input-semester-1" type="text" class="form-control"></input>
+					<input id="input-add-semester-1" type="text" class="form-control"></input>
 				</div>
 				<div class="modal-footer">
 					<button class="btn btn-primary" onclick="confirmSemester()" data-dismiss="modal">添加</button>
@@ -188,17 +188,21 @@
 		
 		function confirmSemester()  //向后台传输新学期的信息
 		{
-			var text1,i;
-			text1=$("#input-semester-1")[0].value;
-			$.post('/manage/AddCourseToCurrentUser',{name: text1,description: ""},   //#modify
+			var text1,i,p;
+			text1=$("#input-add-semester-1")[0].value;
+			p=new Object();
+			p.name=text1;
+			
+			$.post('/semesters.json', p,   //#modify
     		function(data)
     		{
-    			if (data=="fail")
+    			console.log(data);
+    			if (data.status=="failed")
     			{
     				alert("添加失败");
     				return;
     			}
-    			if (data=="succeed")
+    			if (data.status=="successful")
     			{
     				for (i=++info.tot;i>0;--i)
     				{
@@ -211,7 +215,7 @@
     				showInfo();
     				return;
     			}
-    			alert("unexpected:"+data);
+    			alert("unexpected: /semesters.json");
     		}
     		);
 		}
@@ -224,7 +228,7 @@
 			text2=$("#input-add-course-2")[0].value;
 			p.name=text1;
 			p.description=text2;
-			console.log('/semesters/'+info.semesters[choosei].id+'/courses.json');
+			
 			$.post('/semesters/'+info.semesters[choosei].id+'/courses.json',p,  //#modify
     		function(data)
     		{
@@ -294,6 +298,7 @@
 			p.start_time=text3;
 			p.end_time=text4;
 			p.location=text5;
+			
 			$.post('/courses/'+info.semesters[choosei].courses[choosej].id+'/lessons.json',p,  //#modify
     		function(data)
     		{
@@ -335,6 +340,7 @@
 			p.end_time=text4;
 			p.location=text5;
 			console.log(p);
+			
 			$.post('/lessons/'+p.id+'.json',p,  //#modify
     		function(data)
     		{
@@ -467,7 +473,8 @@
 						info.semesters[j].clicked=false;
 					}
 					usersId=data2.id;
-					$.ajax({url:"/teachers/"+usersId+"/course.json",data:{},async:false,type:"GET",success:function(data)    //#modify
+					
+					$.ajax({url:"/teachers/"+usersId+"/courses.json",data:{},async:false,type:"GET",success:function(data)    //#modify
 					{
 						if (data.status=="failed")
 						{
@@ -477,7 +484,7 @@
 						if (data.status=="successful")
 						{
 							data=data.courses;
-							for (p1=0;p1<data.length();++p1)
+							for (p1=0;p1<data.length;++p1)
 							{
 								i=-1;
 								for (j=0;j<info.tot;++j)
@@ -532,6 +539,7 @@
 				console.log(1,data);
 				if (data1&&data2) deal();
 			}});
+			
 			$.ajax({url:"/users/current.json",data:{},type:"GET",success:function(data)    //#modify
 			{
 				data2=data;
@@ -636,23 +644,15 @@
 			event.stopPropagation();
 		}
 		
-		function check(str)
-		{
-			console.log(str);
-			str=str.replace(/\r\n/ig,"<br>");
-			console.log(str);
-			return str;
-		}
-		
-
 		function showInfo()  //显示课程信息
 		{
 			var i,j,k,text="";j=k=-1;
+			
 			for (i=0;i<info.tot;++i)
 			{
 				text+='<div class="rectangleSemester btn btn-default" onclick="change('+i+','+j+','+k+')">';
 				text+='<div class="names">'+info.semesters[i].name+'</div>';
-			//	text+='<div class="btn btn-info custombutton" onclick="addSemester(event)">添加学期</div>';
+				text+='<div class="btn btn-info custombutton" onclick="addSemester(event)">添加学期</div>';
 				text+='<div class="btn btn-info custombutton" onclick="addCourse(event,'+i+')">添加课程</div>';
 				text+='</div>';
 				k=-1;
@@ -684,6 +684,7 @@
 				}
 				j=-1;
 			}
+			
 			$("#content")[0].innerHTML=text;
 		}
 		
-- 
1.9.1

