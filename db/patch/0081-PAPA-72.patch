From 57913e9708a0b63f4ffca12154b19eb05e76c402 Mon Sep 17 00:00:00 2001
From: luogan <luogan_62625686@126.com>
Date: Fri, 16 Oct 2015 09:57:48 +0800
Subject: [PATCH 081/150] PAPA-72

---
 app/views/manage/class_score.html.erb | 53 ++++++++++++++++++++++++++++++++++-
 1 file changed, 52 insertions(+), 1 deletion(-)

diff --git a/app/views/manage/class_score.html.erb b/app/views/manage/class_score.html.erb
index 969b9bc..d10af6b 100644
--- a/app/views/manage/class_score.html.erb
+++ b/app/views/manage/class_score.html.erb
@@ -20,15 +20,30 @@
 	<div id="content">	
 	</div>
 	<script>
+		var courseId,classId;
+		
+		function getId()
+		{
+			var p=window.location.href.split("/");
+			p=p[p.length-1];
+			courseId=p.split("&")[0];
+			classId=p.split("&")[1];
+		}
+		
 		var n,m,info,items,classInfo,lastChoose=-1,p=0,focusi=-1,focusj=-1;
 		
 		function loadInfo()
 		{
+			$.get("/lessons/"+classId+".json",{},
+			function(data)
+			{
+				courseInfo=data.name;
+			});
 			classInfo="计算机组成原理实验1";
 			var i;
 			n=9;m=2;
 			items=new Array();
-			items[0]="学号";items[1]="姓名";items[2]="系";items[3]="班级";items[4]="成绩";items[5]="评价";items[6]="图片";items[7]="视频";items[8]="打分助教";
+			items[0]="学号";items[1]="姓名";items[2]="系";items[3]="班级";items[4]="成绩";items[5]="评价";items[6]="图片数";items[7]="视频数";items[8]="打分助教";
 			info=new Array();
 			for (i=0;i<m;++i)
 			{
@@ -43,6 +58,42 @@
 				info[i][7]="1";
 				info[i][8]="XX";
 			}
+			$.get("/courses/"+courseId+"/students.json",{},
+			function(data)
+			{
+				var i;
+				for (i=0;i<data.length;++i)
+				{
+					info[i]=new Array();
+					$.get("/students/"+data[i].id+".json",{},
+					function(data2)
+					{
+						info[i][0]=data2.student_number;
+						info[i][1]=data2.name;
+						info[i][2]=data2.department;
+						info[i][3]=data2.class;  //#modify
+						info[i][9]=data2.id;
+					});
+					$.get("/students/"+data[i].id+"/lessons/"+classId+".json",{},
+					function(data2)
+					{
+						info[i][4]=data2.score;
+						info[i][5]=data2.content;
+						info[i][8]=data2.assistant;
+					});
+					$.get("/students/"+data[i].id+"/lesssons/"+classId+"/files.json",{},
+					function(data2)
+					{
+						info[i][7]=info[i][8]=0;
+						var j;
+						for (j=0;j<data2.length;++j)
+						{
+							if (data2[j].type=="jpg") ++info[i][6];
+							if (data2[j].type=="mp4") ++info[i][7];
+						}
+					});
+				}
+			});
 		}
 		
 		function compare(x,y,p)
-- 
1.9.1

