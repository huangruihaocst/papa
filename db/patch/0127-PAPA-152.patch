From eb8b1d5abf124228c1ecf7a462a2559755fa536e Mon Sep 17 00:00:00 2001
From: luogan <luogan_62625686@126.com>
Date: Fri, 23 Oct 2015 23:47:29 +0800
Subject: [PATCH 127/150] PAPA-152

---
 app/views/manage/main_page.html.erb | 13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

diff --git a/app/views/manage/main_page.html.erb b/app/views/manage/main_page.html.erb
index 99cb576..a21930a 100644
--- a/app/views/manage/main_page.html.erb
+++ b/app/views/manage/main_page.html.erb
@@ -209,8 +209,10 @@
     				{
     					info.semesters[i]=info.semesters[i-1];
     				}
+    				p.semester.id=data.id;
     				info.semesters[0]=p.semester;
     				info.semesters[0].tot=0;
+    				info.semesters[0].clicked=false;
     				info.semesters[0].courses=new Array();
     				showInfo();
     				return;
@@ -229,7 +231,7 @@
 			p.course=new Object();
 			p.course.name=text1;
 			p.course.description=text2;
-			p.course.semester=info.semesters[choosei].id;
+			p.course.semester_id=info.semesters[choosei].id;
 			console.log(p);
 			
 			$.post('/teachers/'+usersId+'/courses.json', p,
@@ -243,18 +245,21 @@
     			}
     			if (data.status=="successful")
     			{
+    				console.log(choosei);
     				for (i=++info.semesters[choosei].tot;i>0;--i)
     				{
     					info.semesters[choosei].courses[i]=info.semesters[choosei].courses[i-1];
     				}
-    				p.id=data.id;
+    				p.course.id=data.id;
     				info.semesters[choosei].courses[0]=p.course;
     				info.semesters[choosei].courses[0].tot=0;
+    				info.semesters[choosei].courses[0].clicked=false;
     				info.semesters[choosei].courses[0].classes=new Array();
+    				console.log(info.semesters[choosei]);
     				showInfo();
     				return;
     			}
-    			alert("unexpected: confirmCourse");
+    			alert("unexpected: /confirmCourse");
     		}
     		);
     	}
@@ -319,6 +324,7 @@
     					info.semesters[choosei].courses[choosej].classes[i]=info.semesters[choosei].courses[choosej].classes[i-1];
     				}
     				info.semesters[choosei].courses[choosej].classes[0]=p;
+    				info.semesters[choosei].courses[choosej].classes[0].clicked=false;
     				showInfo();
     				return;
     			}
@@ -472,6 +478,7 @@
 						info.semesters[j]=new Object();
 						info.semesters[j].name=data[i].name;
 						info.semesters[j].id=data[i].id;
+						info.semesters[j].tot=0;
 						info.semesters[j].courses=new Array();
 						info.semesters[j].clicked=false;
 					}
-- 
1.9.1

