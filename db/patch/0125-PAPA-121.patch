From b147defd0cb8078f111cf80dbacb25e726475b4e Mon Sep 17 00:00:00 2001
From: luogan <luogan_62625686@126.com>
Date: Fri, 23 Oct 2015 17:06:48 +0800
Subject: [PATCH 125/150] PAPA-121

---
 app/views/manage/main_page.html.erb | 24 ++++++++++++++----------
 1 file changed, 14 insertions(+), 10 deletions(-)

diff --git a/app/views/manage/main_page.html.erb b/app/views/manage/main_page.html.erb
index 4280714..99cb576 100644
--- a/app/views/manage/main_page.html.erb
+++ b/app/views/manage/main_page.html.erb
@@ -191,9 +191,10 @@
 			var text1,i,p;
 			text1=$("#input-add-semester-1")[0].value;
 			p=new Object();
-			p.name=text1;
-			
-			$.post('/semesters.json', p,   //#modify
+			p.semester=new Object();
+			p.semester.name=text1;
+			console.log(p);
+			$.post('/semesters.json', p,
     		function(data)
     		{
     			console.log(data);
@@ -208,8 +209,7 @@
     				{
     					info.semesters[i]=info.semesters[i-1];
     				}
-    				info.semesters[0]=new Object();
-    				info.semesters[0].name=text1;
+    				info.semesters[0]=p.semester;
     				info.semesters[0].tot=0;
     				info.semesters[0].courses=new Array();
     				showInfo();
@@ -223,13 +223,16 @@
 		function confirmCourse()  //新课程的信息
 		{
 			var text1,text2,i,p;
-			p=new Object();
 			text1=$("#input-add-course-1")[0].value;
 			text2=$("#input-add-course-2")[0].value;
-			p.name=text1;
-			p.description=text2;
+			p=new Object();
+			p.course=new Object();
+			p.course.name=text1;
+			p.course.description=text2;
+			p.course.semester=info.semesters[choosei].id;
+			console.log(p);
 			
-			$.post('/semesters/'+info.semesters[choosei].id+'/courses.json',p,  //#modify
+			$.post('/teachers/'+usersId+'/courses.json', p,
     		function(data)
     		{
     			console.log(data);
@@ -245,7 +248,7 @@
     					info.semesters[choosei].courses[i]=info.semesters[choosei].courses[i-1];
     				}
     				p.id=data.id;
-    				info.semesters[choosei].courses[0]=p;
+    				info.semesters[choosei].courses[0]=p.course;
     				info.semesters[choosei].courses[0].tot=0;
     				info.semesters[choosei].courses[0].classes=new Array();
     				showInfo();
@@ -476,6 +479,7 @@
 					
 					$.ajax({url:"/teachers/"+usersId+"/courses.json",data:{},async:false,type:"GET",success:function(data)    //#modify
 					{
+						console.log(data);
 						if (data.status=="failed")
 						{
 							alert("获取信息失败");
-- 
1.9.1

