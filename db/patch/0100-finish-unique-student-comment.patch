From 91e801fbff47cfc02a65740ff034c420f56aec80 Mon Sep 17 00:00:00 2001
From: Alex Wang <ice_b0und@hotmail.com>
Date: Sat, 17 Oct 2015 18:47:38 +0800
Subject: [PATCH 100/150] finish unique student comment

---
 README.md                                        | 11 +++--------
 app/controllers/student_comments_controller.rb   |  8 ++++++++
 app/views/student_comments/default.json.jbuilder |  7 +++++++
 config/routes.rb                                 |  1 +
 4 files changed, 19 insertions(+), 8 deletions(-)
 create mode 100644 app/views/student_comments/default.json.jbuilder

diff --git a/README.md b/README.md
index 81b3bcd..a241735 100644
--- a/README.md
+++ b/README.md
@@ -138,7 +138,8 @@ POST /users/sign_in.json     utf8=✓&user[login]=xxx&user[password]=123&user[re
     #!GET    /lessons/1/comments.json  获得某门课程的评价    "comments": [comment, ...]                   Teacher
     ?GET    /lessons/1/comments.json  获得某门课程的评价    "lesson_comments": [lesson_comment, ...]                   Teacher
     POST   /lessons/1/comments.json  添加学生对课程的评价(当前登陆用户)  lesson comment parameters                    Student
-    GET    /lessons/1/students/1/comments.json 查看助教对学生的评价 "student_comments": [student_comment,...] Student
+    #!GET    /lessons/1/students/1/comments.json 查看助教对学生的评价 "student_comments": [student_comment,...] Student
+    ?GET   /lessons/1/students/1/comment.json  助教对学生的评价 "student_comment": student_comment
     POST   /lessons/1/students/1/comments.json 助教对学生的评价 student comment parameters              Assistant
     GET    /students/1/lessons/1/comments.json 查看学生对课程的所有评价 "lesson_comments": [student_comment,...] Teacher
     GET    /lessons/1/students.json  某门实验课的到课学生列表 students id                               Teacher
@@ -345,13 +346,7 @@ REASON_INVALID_OPERATION = 'invalid_operation' // 访问了不存在的url
     teaching_course id=int
             belongs_to user
             belongs_to course
-    learning_course id=int
-            belongs_to user
-            belongs_to course
-    assisting_course id=int
-            belongs_to user
-            belongs_to course
-            
+
     lesson_status id=int
             score=string
             belongs_to user
diff --git a/app/controllers/student_comments_controller.rb b/app/controllers/student_comments_controller.rb
index 32d6e1e..7ada2ac 100644
--- a/app/controllers/student_comments_controller.rb
+++ b/app/controllers/student_comments_controller.rb
@@ -21,4 +21,12 @@ class StudentCommentsController < ApplicationController
     end
   end
 
+  def default
+    if params[:lesson_id] && params[:student_id]
+      @student_comment = StudentComment.where(lesson_id: params[:lesson_id]).where(student_id: params[:student_id]).last
+    else
+      json_failed
+    end
+  end
+
 end
diff --git a/app/views/student_comments/default.json.jbuilder b/app/views/student_comments/default.json.jbuilder
new file mode 100644
index 0000000..3f4be8b
--- /dev/null
+++ b/app/views/student_comments/default.json.jbuilder
@@ -0,0 +1,7 @@
+json.status STATUS_SUCCESS
+json.student_comment do
+  json.id @student_comment.id
+  json.content @student_comment.content
+  json.creator_id @student_comment.creator_id
+  json.score @student_comment.score
+end
\ No newline at end of file
diff --git a/config/routes.rb b/config/routes.rb
index 85c6c7a..56fb21f 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -34,6 +34,7 @@ Rails.application.routes.draw do
     resources :students, only: [:show] do
       # assistants' comments to the student
       resources :comments, controller: 'student_comments', only: [:index, :create]
+      get 'comment' => 'student_comments#default'
     end
 
     # for attendence
-- 
1.9.1

