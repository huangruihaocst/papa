<head>
	<link href="/common.css" rel=stylesheet type="text/css">
	<style type="text/css">
		.content
		{
			width:50%;
			height:400px;
			font-size:40px;
		}
		#content3
		{
			font-size:30px;
		}
		.comment
		{
			font-size:25px;
			margin-top:30px;
		}
		.author
		{
			font-size:15px;
			margin-top:2px;
		}
		.chart
		{
			width:100%;
			height:300px;
		}
		#content2
		{
			width:80%;
		}
	</style>
</head>
<body>
	<script type="text/javascript" src="/chart.js"></script>
	<div id="content">
		<div id="content1" class="content">
			到课情况</br>
			<canvas id="chart1" class="chart"></canvas>
		</div>
		<div id="content2" class="content">
			学生评分</br>
			<canvas id="chart2" class="chart"></canvas>
		</div>
		<div id="content3">
		</div>
		<div id="contentbutton">
		</div>
	</div>
	<script>
		var courseId,classId;
		
		function getId()
		{
			var p=window.location.href.split("/");
			p=p[p.length-1];
			courseId=p.split("&")[0];
		}
		
		var n=3,m=5,courseInfo,people=new Array(),score=new Array();
		
		function loadInfo()
		{
			var i,j;
			people[0]=new Object();people[1]=new Object();people[2]=new Object();
			people[0].attend=100;people[1].attend=10;people[2].attend=99;
			for (i=0;i<n;++i)
			{
				score[i]=new Array();
				for (j=0;j<m;++j) score[i][j]=(i+1)*(j+1);
			}
			$.get("/courses/"+courseId+".json",{},
			function(data)
			{
				courseInfo=data.name;
			});
			courseInfo="计算机组成原理";
			$.get("/courses/"+courseId+"/lessons.json",{},
			function(data)
			{
				var i;
				for (i=0;i<data.length;++i)
				{
					people[i]=new Object();
					classId=data[i].id;
					$.get("/lessons/"+classId+".json",{},
					function(data2)
					{
						people[i].name=data2.name;
					});
					$.get("/lessons/"+classId+"/students.json",{},
					function(data2)
					{
						people[i].attend=data2.length;
						var j;
						for (j=0;j<data2.length;++j)
						{
							$.get("/students/"+data2[j].id+"/lessons/"+classId+".json",{},
							function(data3)
							{
								++score[i][data3];
							});
						}
					});
				}
			});
		}
		
		function showInfo()
		{
			var data,data2,text="",i;
			data={labels:["实验1","实验2","实验3"],datasets:[{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					data : [people[0].attend,people[1].attend,people[2].attend]}]};
			data2={labels:["0~5分","6~7分","8分","9分","10分"],datasets:[{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					data : [score[0][0],score[0][1],score[0][2],score[0][3],score[0][4]]},
					{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					data : [score[1][0],score[1][1],score[1][2],score[1][3],score[1][4]]},
					{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					data : [score[2][0],score[2][1],score[2][2],score[2][3],score[2][4]]}
					]};
			var mychart,ctx = $("#chart1")[0].getContext("2d");
			mychart=new Chart(ctx).Bar(data);
			ctx = $("#chart2")[0].getContext("2d");
			mychart=new Chart(ctx).Bar(data2);			
		}
		
		loadInfo();
		showInfo();
	</script>
</body>
